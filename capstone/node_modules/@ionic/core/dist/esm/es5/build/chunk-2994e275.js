import*as tslib_1 from"../polyfills/tslib.js";var lastId=0;function createOverlay(e,t){var n=e.ownerDocument;connectListeners(n),Object.assign(e,t),e.classList.add("ion-page-invisible");var i=lastId++;return e.overlayIndex=i,e.hasAttribute("id")||(e.id="ion-overlay-"+i),getAppRoot(n).appendChild(e),e.componentOnReady()}function connectListeners(e){0===lastId&&(lastId=1,e.addEventListener("ionBackButton",function(t){var n=getOverlay(e);n&&n.backdropDismiss&&t.detail.register(100,function(){return n.dismiss(void 0,BACKDROP)})}),e.addEventListener("keyup",function(t){if("Escape"===t.key){var n=getOverlay(e);n&&n.backdropDismiss&&n.dismiss(void 0,BACKDROP)}}))}function dismissOverlay(e,t,n,i,r){var a=getOverlay(e,i,r);return a?a.dismiss(t,n):Promise.reject("overlay does not exist")}function getOverlays(e,t){var n=Array.from(getAppRoot(e).children).filter(function(e){return e.overlayIndex>0});return void 0===t?n:(t=t.toUpperCase(),n.filter(function(e){return e.tagName===t}))}function getOverlay(e,t,n){var i=getOverlays(e,t);return void 0===n?i[i.length-1]:i.find(function(e){return e.id===n})}function present(e,t,n,i,r){return tslib_1.__awaiter(this,void 0,void 0,function(){var a;return tslib_1.__generator(this,function(s){switch(s.label){case 0:return e.presented?[2]:(e.presented=!0,e.willPresent.emit(),a=e.enterAnimation?e.enterAnimation:e.config.get(t,"ios"===e.mode?n:i),[4,overlayAnimation(e,a,e.el,r)]);case 1:return s.sent()&&e.didPresent.emit(),[2]}})})}function dismiss(e,t,n,i,r,a,s){return tslib_1.__awaiter(this,void 0,void 0,function(){var o,c;return tslib_1.__generator(this,function(l){switch(l.label){case 0:if(!e.presented)return[2,!1];e.presented=!1,l.label=1;case 1:return l.trys.push([1,3,,4]),e.willDismiss.emit({data:t,role:n}),o=e.leaveAnimation?e.leaveAnimation:e.config.get(i,"ios"===e.mode?r:a),[4,overlayAnimation(e,o,e.el,s)];case 2:return l.sent(),e.didDismiss.emit({data:t,role:n}),[3,4];case 3:return c=l.sent(),console.error(c),[3,4];case 4:return e.el.remove(),[2,!0]}})})}function getAppRoot(e){return e.querySelector("ion-app")||e.body}function overlayAnimation(e,t,n,i){return tslib_1.__awaiter(this,void 0,void 0,function(){var r,a,s;return tslib_1.__generator(this,function(o){switch(o.label){case 0:return e.animation?(e.animation.destroy(),e.animation=void 0,[2,!1]):[3,1];case 1:return n.classList.remove("ion-page-invisible"),a=e,[4,e.animationCtrl.create(t,n.shadowRoot||e.el,i)];case 2:return r=a.animation=o.sent(),e.animation=r,e.animated||r.duration(0),e.keyboardClose&&r.beforeAddWrite(function(){var e=n.ownerDocument.activeElement;e&&e.matches("input, ion-input, ion-textarea")&&e.blur()}),[4,r.playAsync()];case 3:return o.sent(),s=r.hasCompleted,r.destroy(),e.animation=void 0,[2,s]}})})}function eventMethod(e,t){var n,i=new Promise(function(e){return n=e});return onceEvent(e,t,function(e){n(e.detail)}),i}function onceEvent(e,t,n){var i=function(r){e.removeEventListener(t,i),n(r)};e.addEventListener(t,i)}function isCancel(e){return"cancel"===e||e===BACKDROP}var BACKDROP="backdrop";export{BACKDROP as a,dismiss as b,eventMethod as c,isCancel as d,present as e,createOverlay as f,dismissOverlay as g,getOverlay as h};